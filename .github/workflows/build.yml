name: test run scratch

# Definition when the workflow should run
on:
  # The workflow will run whenever an event happens on a pull request
  pull_request:
    types: [opened, synchronize]

jobs:
  validate_npc:
    runs-on: ubuntu-latest
    steps:
      # Checkout the code in the pull request
      - name: "Checkout source code"
        uses: actions/checkout@v3
      # Load secret for dev hub
      - name: "Populate auth file with SFDX_URL secret"
        shell: bash
        run: "echo ${{ secrets.DEVHUB_SFDX_URL}} > ./SFDX_URL_STORE.txt"
      - name: "Authenticate against dev hub"
        uses: forcedotcom/salesforcedx-actions@master
        with:
          args: "force:auth:sfdxurl:store --sfdxurlfile=./SFDX_URL_STORE.txt --setalias=devhub --setdefaultdevhubusername"
      # Create a scratch org
      - name: "Create scratch org"
        uses: forcedotcom/salesforcedx-actions@master
        with:
          args: "org create scratch -d -f config/nonprofit-cloud.json -a npc-org"
